<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="做 Lab 之前，建议先看看 PortSwigger 研究员 Martin 在今年 BlackHat 上公布的最新研究成果：Gotta cache ‘em all: bending the rules of web cache exploitation  PS: 今年 BlackHat 大会，PortSwigger 杀疯了！ 1 Lab: Exploiting path mapping for w">
<meta property="og:type" content="article">
<meta property="og:title" content="PortSwigger web cache deception labs">
<meta property="og:url" content="https://by-musi.github.io/2024/09/11/PortSwigger_web_cache_deception_labs/index.html">
<meta property="og:site_name" content="OhMyDarkSpace">
<meta property="og:description" content="做 Lab 之前，建议先看看 PortSwigger 研究员 Martin 在今年 BlackHat 上公布的最新研究成果：Gotta cache ‘em all: bending the rules of web cache exploitation  PS: 今年 BlackHat 大会，PortSwigger 杀疯了！ 1 Lab: Exploiting path mapping for w">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829161804.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829162319.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829162541.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829162714.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829161254.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829163521.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829161326.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904170853.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904171116.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904171438.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904171533.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904171657.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904171809.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904172034.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904173258.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904173816.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904174337.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829225711.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829230315.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829230457.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829231550.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829232606.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829231953.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829235536.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829235901.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829233211.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240830000449.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240901233649.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904200150.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904200415.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904201102.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904200852.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904201357.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904202024.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904202836.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904202951.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904204151.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904204309.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904204647.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904210353.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904205746.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904213619.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904214415.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904214836.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904215127.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240904233025.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240905101434.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240905101744.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240905105007.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240905103854.png">
<meta property="og:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240905111803.png">
<meta property="article:published_time" content="2024-09-10T16:00:00.000Z">
<meta property="article:modified_time" content="2024-09-10T16:00:00.000Z">
<meta property="article:author" content="CaiShao">
<meta property="article:tag" content="Web cache deception">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://by-musi.github.io/images/2024/09/11/Pasted_image_20240829161804.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>PortSwigger web cache deception labs</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	

  <!-- fancybox -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" />
  
<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="OhMyDarkSpace" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="OhMyDarkSpace" type="application/rss+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2024/07/09/PortSwigger_GraphQL_labs/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://by-musi.github.io/2024/09/11/PortSwigger_web_cache_deception_labs/&title=PortSwigger web cache deception labs"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Lab-Exploiting-path-mapping-for-web-cache-deception"><span class="toc-number">1.</span> <span class="toc-text">1 Lab: Exploiting path mapping for web cache deception</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Lab-Exploiting-path-delimiters-for-web-cache-deception"><span class="toc-number">2.</span> <span class="toc-text">2 Lab: Exploiting path delimiters for web cache deception</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Lab-Exploiting-origin-server-normalization-for-web-cache-deception"><span class="toc-number">3.</span> <span class="toc-text">3 Lab: Exploiting origin server normalization for web cache deception</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Exploiting-origin-server-normalization-for-web-cache-deception"><span class="toc-number">4.</span> <span class="toc-text">4 Exploiting origin server normalization for web cache deception</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Lab-Exploiting-exact-match-cache-rules-for-web-cache-deception"><span class="toc-number">5.</span> <span class="toc-text">5 Lab: Exploiting exact-match cache rules for web cache deception</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        PortSwigger web cache deception labs
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">CaiShao</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-09-10T16:00:00.000Z" class="dt-published" itemprop="datePublished">2024-09-11</time>
        
        (Updated: <time datetime="2024-09-10T16:00:00.000Z" class="dt-updated" itemprop="dateModified">2024-09-11</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Web-cache-deception/" rel="tag">Web cache deception</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>做 Lab 之前，建议先看看 PortSwigger 研究员 Martin 在今年 BlackHat 上公布的最新研究成果：<a target="_blank" rel="noopener" href="https://portswigger.net/research/gotta-cache-em-all">Gotta cache ‘em all: bending the rules of web cache exploitation</a> </p>
<p>PS: 今年 BlackHat 大会，PortSwigger 杀疯了！</p>
<h1 id="1-Lab-Exploiting-path-mapping-for-web-cache-deception"><a href="#1-Lab-Exploiting-path-mapping-for-web-cache-deception" class="headerlink" title="1 Lab: Exploiting path mapping for web cache deception"></a>1 Lab: Exploiting path mapping for web cache deception</h1><p>第一步先定位存在敏感数据的页面 (endpoint)。</p>
<p>登录成功后，用户页展示 username 和 API key.</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829161804.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829161804.png"></a></p>
<p>敏感信息的 endpoint 为 <code>GET /my-account</code>.</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829162319.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829162319.png"></a></p>
<p>静态文件会被缓存，通过 <code>X-Cache</code> 判断哪些响应被缓存。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829162541.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829162541.png"></a></p>
<p>缓存规则为静态文件扩展名，<code>.css</code> 的文件都被缓存了。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829162714.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829162714.png"></a></p>
<p>第二步，判断源服务器和缓存服务器处理 URL 路径的差异。修改路径为 <code>/my-account/.css</code> 发现源服务器仍可返回对应的用户主页，且报文被缓存 (<code>X-Cache</code> 头部)。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829161254.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829161254.png"></a></p>
<p>右键 –&gt; Engagement tools –&gt; Generate CSRF poc，发送到 exploit server –&gt; Deliver exploit to victim</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;form action=&quot;https://0a9d00360386549b810634b70095002c.web-security-academy.net/resources/css/.css&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;submit&quot; value=&quot;Submit request&quot; /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">      history.pushState(&#x27;&#x27;, &#x27;&#x27;, &#x27;/&#x27;);</span><br><span class="line">      document.forms[0].submit();</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>回到 Repeater 再次发送报文，发现命中了缓存，这里注意缓存的有效时间。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829163521.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829163521.png"></a></p>
<p>找到敏感信息，提交即可。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829161326.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829161326.png"></a></p>
<h1 id="2-Lab-Exploiting-path-delimiters-for-web-cache-deception"><a href="#2-Lab-Exploiting-path-delimiters-for-web-cache-deception" class="headerlink" title="2 Lab: Exploiting path delimiters for web cache deception"></a>2 Lab: Exploiting path delimiters for web cache deception</h1><ol>
<li>找下 origin server 的路径分隔符</li>
</ol>
<p>为了避免 cache server 的影响，我选择 <code>POST /login</code> 进行测试。先随便加个字符看看响应。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904170853.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904170853.png"></a></p>
<p>正常发包拿到的响应应该是 400，因为登录用的 CSRF token 已经过期了。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904171116.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904171116.png"></a></p>
<p>用 Intruder 暴一下分隔符。其实都不用暴，我随便输了个 ? 就是分隔符，emmm。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904171438.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904171438.png"></a></p>
<p>但爆破结果却都是 404，点开后发现字典里的分隔符（payload）被编码了。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904171533.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904171533.png"></a></p>
<p>去掉 “Payload encoding” 选项再次爆破</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904171657.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904171657.png"></a></p>
<p>源服务器路径分隔符为 ? 和 ;</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904171809.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904171809.png"></a></p>
<ol start="2">
<li>判断缓存规则</li>
</ol>
<p>感觉应该是缓存的特定拓展名，修改文件名为 <code>caishao.js</code>，响应被缓存了。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904172034.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904172034.png"></a></p>
<p>当然也可以测试其它情况，<code>/caishao.js</code> 看看 <code>/resources</code> 是否会影响缓存规则，还有 <code>/resources/caishao</code> 等等。</p>
<ol start="3">
<li>判断 origin server 的分隔符在 cache server 上是否生效</li>
</ol>
<p>由于 POST 请求不会被缓存，所以这里我换了一个请求，<code>/my-account</code>。在末尾添加 <code>.js</code> 拓展名，响应 200 但未缓存。说明 ? 对缓存服务器来说也是分隔符，<code>/my-account?caishao.js</code> 被解释成了 <code>/my-account</code>。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904173258.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904173258.png"></a></p>
<p>请求 <code>/my-account;caishao.js</code>，响应 200 且被缓存。说明 <code>;</code> 不是缓存服务器的路径分隔符，缓存服务器视角为 <code>/my-account;caishao.js</code>，命中扩展名 js，所以缓存。而已知 <code>;</code> 是源服务器的分隔符，源服务器视角为 <code>/my-account</code>，返回正确响应。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904173816.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904173816.png"></a></p>
<p>右键请求报文生成 CSRF POC，复制到 exploit server，再发送给受害人。然后回到 Burp Repeater 重新请求 <code>/my-account;caishao.js</code>，命中受害人缓存，拿到敏感信息。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904174337.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904174337.png"></a></p>
<blockquote>
<p>&#96;记得把 Param Miner 插件自动添加 cache buster 关了！</p>
</blockquote>
<h1 id="3-Lab-Exploiting-origin-server-normalization-for-web-cache-deception"><a href="#3-Lab-Exploiting-origin-server-normalization-for-web-cache-deception" class="headerlink" title="3 Lab: Exploiting origin server normalization for web cache deception"></a>3 Lab: Exploiting origin server normalization for web cache deception</h1><p>包含敏感信息的 endpoint 仍然是 <code>GET /my-account</code></p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829225711.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829225711.png"></a></p>
<ol>
<li>Detecting normalization by the origin server</li>
</ol>
<p>测试源服务器是否会标准化解析 URL 路径。找一个响应不会被缓存的 endpoint（排除缓存服务器的影响），<code>POST /login</code>，POST 方法请求的响应报文一般不会被缓存。</p>
<p>因为 csrf token 一定用过了，返回一个 400。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829230315.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829230315.png"></a></p>
<p>修改请求报文，测试目录穿越，响应仍然是 400，说明源服务器将请求解析成了 <code>/login</code>，反之，如解析成 <code>/caishao/..%2flogin</code> 本身，应该会返回一个 404.</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829230457.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829230457.png"></a></p>
<ol start="2">
<li>判断缓存规则</li>
</ol>
<p>浏览下 Proxy History 发现被缓存的基本都是静态文件，且都是 <code>/resources</code> 打头的，猜测缓存规则可能是匹配的静态目录（其实是题目上说的，哈哈）。构造请求报文如下图，响应虽然是个 404，但提示被缓存了，说明缓存是匹配的静态目录 <code>/resources</code>。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829231550.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829231550.png"></a></p>
<p>貌似确实得 <code>/resources</code> 打头，目录里面包含都不能缓存。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829232606.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829232606.png"></a></p>
<p>顺带测一下缓存是否会匹配扩展名，均得到 404 且未缓存。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829231953.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829231953.png"></a></p>
<ol start="3">
<li>Detecting normalization by the cache server</li>
</ol>
<p>测试缓存服务器是否会标准化解析 URL 路径。找一个响应被缓存的静态文件请求，<code>GET /resources/labheader/css/academyLabHeader.css</code>。路径长一点，能多测一会儿。</p>
<p>修改请求路径为：<code>/caishao/..%2fresources/labheader/css/academyLabHeader.css</code>，响应没被缓存，说明没有解析 <code>..%2f</code>。反之，如果 cache server 规范化路径为 <code>/resources/labheader/css/academyLabHeader.css</code>，则命中缓存规则。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829235536.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829235536.png"></a></p>
<p>仅添加 <code>..%2f</code> 得到 404 但响应被缓存了，说明缓存规则为匹配 <code>/resources</code> 前缀且缓存服务器不会对路径进行规范化。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829235901.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829235901.png"></a></p>
<p>将 <code>/caishao/..%2f</code> 挪到中间即可获取到 200 响应且响应被缓存。但 cache key 与直接请求 <code>/resources/labheader/css/academyLabHeader.css</code> 不同，两者命中的是不同的缓存。这也更说明了路径规范化是在源服务器上进行了，当然也有一种可能是缓存服务器先匹配规则再规范化路径再发送到源服务器。So，如何判断第二种可能性？</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240829233211.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240829233211.png"></a></p>
<p>结合上述所有点：</p>
<ol>
<li>源服务器进行路径规范化</li>
<li>缓存服务器不会规范化路径</li>
<li>缓存规则为匹配 <code>/resources</code> 前缀</li>
<li>敏感信息 endpoint 为 <code>GET /my-account</code></li>
</ol>
<p>套公式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/&lt;static-directory-prefix&gt;/..%2f&lt;dynamic-path&gt;</span><br></pre></td></tr></table></figure>

<p>构造请求报文，将敏感信息缓存下来。因为缓存服务器基本都没有认证措施，直接访问 url <code>https://example.com/resources/..%2fmy-account</code>，即可获取到缓存中的敏感信息。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240830000449.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240830000449.png"></a></p>
<p>妈的利用不了啊！！！发送给 victim 的 url，我自己访问死活命中不了缓存啊？！</p>
<p>应该是 Param Miner 的问题，它自动给我加了 cache buster，关掉之后就好了。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240901233649.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240901233649.png"></a></p>
<h1 id="4-Exploiting-origin-server-normalization-for-web-cache-deception"><a href="#4-Exploiting-origin-server-normalization-for-web-cache-deception" class="headerlink" title="4 Exploiting origin server normalization for web cache deception"></a>4 Exploiting origin server normalization for web cache deception</h1><ol>
<li>判断缓存规则。</li>
</ol>
<p>大概率是 <code>/resources</code> 打头的都缓存。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904200150.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904200150.png"></a></p>
<p>缓存规则不是匹配扩展名。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904200415.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904200415.png"></a></p>
<ol start="2">
<li>找源服务器的路径分隔符</li>
</ol>
<p>选一个不会被缓存的报文开始爆破。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904201102.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904201102.png"></a></p>
<p>爆破之后发现路径分隔符为 <code>#</code>, <code>?</code> 及其 URL 编码 <code>%23, %3F</code>。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904200852.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904200852.png"></a></p>
<ol start="3">
<li>测试源服务器是否会规范化路径（路径穿越</li>
</ol>
<p>并不会。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904201357.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904201357.png"></a></p>
<ol start="4">
<li>测试缓存服务器路径分隔符，找在源服务器有效而在缓存服务器上无效的。</li>
</ol>
<p>WTF? 分隔符跟源服务器一样一样的？（–&gt;看下面</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904202024.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904202024.png"></a></p>
<ol start="5">
<li>缓存服务器是否存在路径穿越</li>
</ol>
<p>响应被缓存，说明缓存服务器对路径进行了规范化，将其解析成了 <code>/resources/js/tracking.js</code>.</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904202836.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904202836.png"></a></p>
<p>跟 <code>/resources/js/tracking.js</code> 命中了同样的规则。在有效期内请求 <code>/resources/js/tracking.js</code> 响应 404，命中缓存。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904202951.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904202951.png"></a></p>
<p>再说回上文中缓存服务器路径分隔符的问题。爆破的时候，响应码为 200 的报文并不能说明缓存服务器也有这个路径分隔符，很大概率是源服务器解析后返回的。如下图所示，如果 <code>#</code> 为缓存服务器的分隔符，响应报文是不会被缓存的，<code>/caishao#/..%2f/resources/caishao</code> 命中缓存规则，说明它被解析成了 <code>/resources/caishao</code>。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904204151.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904204151.png"></a></p>
<p>综上，构造 POC，成功缓存敏感信息。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904204309.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904204309.png"></a></p>
<p>右键生成 CSRF poc，复制到 exploit server，再发送给受害人。然后回到 Burp Repeater 再发送一下报文即可。</p>
<p>注意下自动生成的 csrf poc 中的 url 不是很对，记得修改。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904204647.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904204647.png"></a></p>
<p><code>#</code> 和其 URL 编码 <code>%23</code> 命中的是同样的缓存规则，但我用 <code>#</code> 的时候死活命中不了受害人的缓存，查看了下 Burp Logger 发现所有 <code>/my-account#/..%2fresources/caishao</code> 的请求路径都是 <code>/my-account</code>，难怪前面生成的 poc 不对。但是响应也确实是缓存了，或许只是 Burp 显示的问题？（又试了好几遍直接用 <code>#</code>，都不行，命中不了受害人的缓存）</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904210353.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904210353.png"></a></p>
<p>原文好像建议把路径穿越序列都编码，写成这种 <code>%2f%2e%2e%2f</code>，记得改一下。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904205746.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904205746.png"></a></p>
<h1 id="5-Lab-Exploiting-exact-match-cache-rules-for-web-cache-deception"><a href="#5-Lab-Exploiting-exact-match-cache-rules-for-web-cache-deception" class="headerlink" title="5 Lab: Exploiting exact-match cache rules for web cache deception"></a>5 Lab: Exploiting exact-match cache rules for web cache deception</h1><ol>
<li>测试缓存规则</li>
</ol>
<p>看了半天能缓存的好像就一个图标，缓存规则好像是精准匹配文件名 <code>/favicon.ico</code>。我测试了 <code>/caishao.ico</code>, <code>/resources/favicon.ico</code> 等，响应都没有被缓存，说明既不是扩展名也不是静态目录名称。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904213619.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904213619.png"></a></p>
<ol start="2">
<li>测试源服务器目录穿越。返回 404 说明源服务器不会规范化路径。</li>
</ol>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904214415.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904214415.png"></a></p>
<ol start="3">
<li>测试源服务器路径分隔符。还是原来的方法，爆就完事了。分隔符为 <code>;</code> 和 <code>?</code></li>
</ol>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904214836.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904214836.png"></a></p>
<ol start="4">
<li>测试缓存服务器是否存在路径穿越。发现如下报文，响应被缓存，说明匹配到缓存规则，<code>/caishao%2F%2E%2E%2Ffavicon.ico</code> 被解析成了 <code>/favicon.ico</code>。</li>
</ol>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904215127.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904215127.png"></a></p>
<ol start="5">
<li>结合 delimiter 和 normalization 利用缓存规则。</li>
</ol>
<p>请求 <code>/my-account;%2F%2E%2E%2F/favicon.ico</code> 只能被缓存，但拿不到 <code>/my-account</code> 的数据。<strong>为什么？</strong></p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240904233025.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240904233025.png"></a></p>
<p><code>/my-account;%2F%2E%2E%2F/favicon.ico</code> 和 <code>/my-account%2F%2E%2E%2F/favicon.ico</code> 命中相同的规则，都是 <code>/favicon.ico</code>。连续交替发送这两个请求，看看缓存是 hit 还是 miss 不难得出这个结论。</p>
<p><code>/my-account;%2F%2E%2E%2F/favicon.ico</code> 的响应报文怎么又变成 200 了？？？？</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240905101434.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240905101434.png"></a></p>
<p>检查一下 Logger 发现，我每次在请求 <code>/my-account;%2F%2E%2E%2F/favicon.ico</code> 之前都先请求了 <code>/my-account%2F%2E%2E%2F/favicon.ico</code>，这两者命中的是相同的缓存，所以 <code>/my-account;%2F%2E%2E%2F/favicon.ico</code> 总是返回 404。此外，这些响应报文中的 <code>X-Cache</code> 头部均为 <code>hit</code>，说明响应被缓存影响了。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240905101744.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240905101744.png"></a></p>
<p>截至目前，我们已经可以利用缓存规则把敏感信息存入缓存了。However，题目要求是借助 exploit server 修改 <code>administrator</code> 用户的邮箱地址。</p>
<p>先来看一下修改邮箱 <code>POST /my-account/change-email</code> 的消息体。除了新的邮箱地址还有一个 CSRF token。此外修改邮箱不需要邮箱验证码，借助简单的 CSRF 即可攻击成功。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">email=caishao%40portswigger.net&amp;csrf=xoOJ3JcF0RMizdEcPveJbzC8mPvfYWTF</span><br></pre></td></tr></table></figure>

<p>思路：使用 web cache deception 拿到管理员的 csrf token，然后将其放到 CSRF PoC 中，发送给 exploit server，当管理员访问恶意页面时，会自动发送 POST 请求修改邮箱地址。</p>
<p>拿到管理员 csrf token <code>7AkFUISuKLCBTBaLrFrXYB5Lq2eN06pb</code>。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240905105007.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240905105007.png"></a></p>
<p>修改 POC 中的 csrf token 并发送。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://0aee00ef045ba8b5806c21c600020035.web-security-academy.net/my-account/change-email&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;caishao<span class="symbol">&amp;#64;</span>portswigger<span class="symbol">&amp;#46;</span>net&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrf&quot;</span> <span class="attr">value</span>=<span class="string">&quot;[修改这里]&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit request&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      history.<span class="title function_">pushState</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="number">0</span>].<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然鹅发送之后并没有显示 lab resolved。</p>
<p>？？？？？我把相同的 poc 重新发送了一遍就好了？？？？难道说是之前发送之后管理员没点到我的 poc 页面？&#x3D;&gt; <strong>具体原因留待后面学 csrf 再研究</strong>。</p>
<p>expert 难度也不是很难嘛，风停了雨静了我觉得我又行了。不过，说实话这个 lab 没加任何 csrf 防御（除了 csrf token）实际环境应该很少遇到这种。</p>
<hr>
<p>有点没看懂这两行是干嘛的。</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240905103854.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240905103854.png"></a></p>
<p><code>validateSession.js</code> 源码如下，貌似是每次访问 <code>/my-account</code> 页面时验证 Session 有效性的。PS：我真是憨憨，这玩意一眼都没看出来。我一度以为修改邮箱的时候会发两个报文，一个验证 csrf token，一个修改邮箱，emmm。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">validateSession</span>(<span class="params">loginPath</span>) &#123;</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&#x27;/validateSession&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">body</span>: <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123;</span><br><span class="line">            <span class="attr">csrf</span>: <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;csrf&quot;</span>)[<span class="number">0</span>]?.<span class="property">value</span></span><br><span class="line">        &#125;).<span class="title function_">toString</span>()</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span> = loginPath;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ).<span class="title function_">catch</span>( <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="property">location</span> = loginPath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PortSwigger web 缓存欺骗的 lab 就全部做完啦！！完结撒花！做题的时候我全程没加 cache buster，实际环境测试别忘了加，我不想进局子（当然，得先能挖到洞 emmm）</p>
<p><a data-fancybox="gallery" data-src="/images/2024/09/11/Pasted_image_20240905111803.png" data-caption=""><img src="/images/2024/09/11/Pasted_image_20240905111803.png"></a></p>

  </div>

  <!-- 版权声明 -->
  


</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a href="/tags/">标签</a></li>
        
          <li><a href="/search/">搜索</a></li>
        
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Lab-Exploiting-path-mapping-for-web-cache-deception"><span class="toc-number">1.</span> <span class="toc-text">1 Lab: Exploiting path mapping for web cache deception</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Lab-Exploiting-path-delimiters-for-web-cache-deception"><span class="toc-number">2.</span> <span class="toc-text">2 Lab: Exploiting path delimiters for web cache deception</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Lab-Exploiting-origin-server-normalization-for-web-cache-deception"><span class="toc-number">3.</span> <span class="toc-text">3 Lab: Exploiting origin server normalization for web cache deception</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Exploiting-origin-server-normalization-for-web-cache-deception"><span class="toc-number">4.</span> <span class="toc-text">4 Exploiting origin server normalization for web cache deception</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Lab-Exploiting-exact-match-cache-rules-for-web-cache-deception"><span class="toc-number">5.</span> <span class="toc-text">5 Lab: Exploiting exact-match cache rules for web cache deception</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://by-musi.github.io/2024/09/11/PortSwigger_web_cache_deception_labs/&title=PortSwigger web cache deception labs"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2024
    CaiShao
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     -->
      </ul>
      <ul>
        
          <span id="busuanzi_container_site_pv">
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
          </span>
          <span class="post-meta-divider"> | </span>
          <span id="busuanzi_container_site_uv" style='display:none'>
                本站访客数<span id="busuanzi_value_site_uv"></span>人
          </span>
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'BY-musi/BY-musi.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'comment';
      var utterances_theme = 'photon-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>


<!-- FancyBox -->

  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>
  <script>
    Fancybox.bind('[data-fancybox="gallery"]', {
      //
    });    
  </script>


<!-- Copyright -->

</body>
</html>
